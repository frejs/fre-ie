{"version":3,"file":"freie.js","sources":["../polyfil.js","../node_modules/fre/dist/fre.esm.js","../src/index.js"],"sourcesContent":["!window.addEventListener &&\r\n  (function (WindowPrototype, DocumentPrototype, ElementPrototype, addEventListener, removeEventListener, dispatchEvent, registry) {\r\n    WindowPrototype[addEventListener] = DocumentPrototype[addEventListener] = ElementPrototype[addEventListener] = function (type, listener) {\r\n      var target = this\r\n\r\n      registry.unshift([\r\n        target,\r\n        type,\r\n        listener,\r\n        function (event) {\r\n          event.currentTarget = target\r\n          event.preventDefault = function () {\r\n            event.returnValue = false\r\n          }\r\n          event.stopPropagation = function () {\r\n            event.cancelBubble = true\r\n          }\r\n          event.target = event.srcElement || target\r\n\r\n          listener.call(target, event)\r\n        },\r\n      ])\r\n\r\n      this.attachEvent('on' + type, registry[0][3])\r\n    }\r\n\r\n    WindowPrototype[removeEventListener] = DocumentPrototype[removeEventListener] = ElementPrototype[removeEventListener] = function (\r\n      type,\r\n      listener\r\n    ) {\r\n      for (var index = 0, register; (register = registry[index]); ++index) {\r\n        if (register[0] == this && register[1] == type && register[2] == listener) {\r\n          return this.detachEvent('on' + type, registry.splice(index, 1)[0][3])\r\n        }\r\n      }\r\n    }\r\n\r\n    WindowPrototype[dispatchEvent] = DocumentPrototype[dispatchEvent] = ElementPrototype[dispatchEvent] = function (eventObject) {\r\n      return this.fireEvent('on' + eventObject.type, eventObject)\r\n    }\r\n  })(Window.prototype, HTMLDocument.prototype, Element.prototype, 'addEventListener', 'removeEventListener', 'dispatchEvent', [])\r\n\r\ndocument.createTextNode = function (data) {\r\n  const text = document.createElement('x-text')\r\n  text.innerText = data\r\n\r\n  return text\r\n}\r\n\r\nif (!('performance' in window)) {\r\n  window.performance = {}\r\n}\r\nvar perf = window.performance\r\nwindow.performance.now =\r\n  perf.now ||\r\n  perf.mozNow ||\r\n  perf.msNow ||\r\n  perf.oNow ||\r\n  perf.webkitNow ||\r\n  Date.now ||\r\n  function () {\r\n    return new Date().getTime()\r\n  }\r\n\r\nif (!Array.isArray) {\r\n  Array.isArray = (function (toString) {\r\n    var $ = toString.call([])\r\n    return function isArray(object) {\r\n      return toString.call(object) === $\r\n    }\r\n  })({}.toString)\r\n}\r\n\r\nif (!Array.prototype.forEach) {\r\n  Array.prototype.forEach = function (fn, scope) {\r\n    var i, len\r\n    for (i = 0, len = this.length; i < len; ++i) {\r\n      if (i in this) {\r\n        fn.call(scope, this[i], i, this)\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nif (typeof Function.prototype.bind !== 'function') {\r\n  Function.prototype.bind = function () {\r\n    var fn = this\r\n    var args = arguments\r\n    return function () {\r\n      return fn.call.apply(fn, args)\r\n    }\r\n  }\r\n}\r\n","const isArr = Array.isArray;\r\nconst isStr = s => typeof s === 'string' || typeof s === 'number';\r\nconst MEMO = 0;\r\n\r\nfunction h(type, attrs, ...args) {\r\n  let props = attrs || {};\r\n  let key = props.key || null;\r\n  let ref = props.ref || null;\r\n  let children = [];\r\n\r\n  for (let i = 0; i < args.length; i++) {\r\n    let vnode = args[i];\r\n    if (vnode == null || vnode === true || vnode === false) ; else if (isStr(vnode)) {\r\n      children.push(createText(vnode));\r\n    } else {\r\n      while (isArr(vnode) && vnode.some(v => isArr(v))) {\r\n        vnode = [].concat(...vnode);\r\n      }\r\n      children.push(vnode);\r\n    }\r\n  }\r\n\r\n  if (children.length) {\r\n    props.children = children.length === 1 ? children[0] : children;\r\n  }\r\n\r\n  delete props.key;\r\n  delete props.ref;\r\n\r\n  return { type, props, key, ref }\r\n}\r\n\r\nfunction createText(vnode) {\r\n  return { type: 'text', props: { nodeValue: vnode } }\r\n}\r\n\r\nfunction Fragment(props) {\r\n  return props.children\r\n}\r\n\r\nfunction memo(fn) {\r\n  fn.tag = MEMO;\r\n  return fn\r\n}\r\n\r\nfunction updateElement(dom, oldProps, newProps) {\r\n  for (let name in { ...oldProps, ...newProps }) {\r\n    let oldValue = oldProps[name];\r\n    let newValue = newProps[name];\r\n\r\n    if (oldValue == newValue || name === 'children') ; else if (name === 'style') {\r\n      for (const k in { ...oldValue, ...newValue }) {\r\n        if (!(oldValue && newValue && oldValue[k] === newValue[k])) {\r\n          dom[name][k] = (newValue && newValue[k]) || '';\r\n        }\r\n      }\r\n    } else if (name[0] === 'o' && name[1] === 'n') {\r\n      name = name.slice(2).toLowerCase();\r\n      if (oldValue) dom.removeEventListener(name, oldValue);\r\n      dom.addEventListener(name, newValue);\r\n    } else if (name in dom && !(dom instanceof SVGElement)) {\r\n      dom[name] = newValue == null ? '' : newValue;\r\n    } else if (newValue == null || newValue === false) {\r\n      dom.removeAttribute(name);\r\n    } else {\r\n      dom.setAttribute(name, newValue);\r\n    }\r\n  }\r\n}\r\n\r\nfunction createElement(fiber) {\r\n  const dom =\r\n    fiber.type === 'text'\r\n      ? document.createTextNode(fiber.props.nodeValue)\r\n      : fiber.tag === SVG\r\n      ? document.createElementNS('http://www.w3.org/2000/svg', fiber.type)\r\n      : document.createElement(fiber.type);\r\n  updateElement(dom, {}, fiber.props);\r\n  return dom\r\n}\r\n\r\nlet cursor = 0;\r\n\r\nfunction resetCursor() {\r\n  cursor = 0;\r\n}\r\n\r\nfunction useState(initState) {\r\n  return useReducer(null, initState)\r\n}\r\n\r\nfunction useReducer(reducer, initState) {\r\n  const [hook, current] = getHook(cursor++);\r\n  const setter = value => {\r\n    let newValue = reducer\r\n      ? reducer(hook[0], value)\r\n      : isFn(value)\r\n      ? value(hook[0])\r\n      : value;\r\n    if (newValue !== hook[0]) {\r\n      hook[0] = newValue;\r\n      scheduleWork(current);\r\n    }\r\n  };\r\n\r\n  if (hook.length) {\r\n    return [hook[0], setter]\r\n  } else {\r\n    hook[0] = initState;\r\n    return [initState, setter]\r\n  }\r\n}\r\n\r\nfunction useEffect(cb, deps) {\r\n  return effectImpl(cb, deps, 'effect')\r\n}\r\n\r\nfunction useLayout(cb, deps) {\r\n  return effectImpl(cb, deps, 'layout')\r\n}\r\n\r\nfunction effectImpl(cb, deps, key) {\r\n  let [hook, current] = getHook(cursor++);\r\n  if (isChanged(hook[1], deps)) {\r\n    hook[0] = useCallback(cb, deps);\r\n    hook[1] = deps;\r\n    current.hooks[key].push(hook);\r\n  }\r\n}\r\n\r\nfunction useMemo(cb, deps) {\r\n  let hook = getHook(cursor++)[0];\r\n  if (isChanged(hook[1], deps)) {\r\n    hook[1] = deps;\r\n    return (hook[0] = cb())\r\n  }\r\n  return hook[0]\r\n}\r\n\r\nfunction useCallback(cb, deps) {\r\n  return useMemo(() => cb, deps)\r\n}\r\n\r\nfunction useRef(current) {\r\n  return useMemo(() => ({ current }), [])\r\n}\r\n\r\nfunction getHook(cursor) {\r\n  const current = getCurrentFiber();\r\n  let hooks =\r\n    current.hooks || (current.hooks = { list: [], effect: [], layout: [] });\r\n  if (cursor >= hooks.list.length) {\r\n    hooks.list.push([]);\r\n  }\r\n  return [hooks.list[cursor], current]\r\n}\r\n\r\nfunction isChanged(a, b) {\r\n  return !a || b.some((arg, index) => arg !== a[index])\r\n}\r\n\r\nfunction push(heap, node) {\r\n  const i = heap.length;\r\n  heap.push(node);\r\n  siftUp(heap, node, i);\r\n}\r\n\r\nfunction pop(heap) {\r\n  const first = heap[0];\r\n  if (!first) return null\r\n  const last = heap.pop();\r\n  if (last !== first) {\r\n    heap[0] = last;\r\n    siftDown(heap, last, 0);\r\n  }\r\n  return first\r\n}\r\n\r\nfunction siftUp(heap, node, i) {\r\n  while (i > 0) {\r\n    const pi = (i - 1) >>> 1;\r\n    const parent = heap[pi];\r\n    if (cmp(parent, node) <= 0) return\r\n    heap[pi] = node;\r\n    heap[i] = parent;\r\n    i = pi;\r\n  }\r\n}\r\n\r\nfunction siftDown(heap, node, i) {\r\n  for (;;) {\r\n    const li = i * 2 + 1;\r\n    const left = heap[li];\r\n    if (li >= heap.length) return\r\n    const ri = li + 1;\r\n    const right = heap[ri];\r\n    const ci = ri < heap.length && cmp(right, left) < 0 ? ri : li;\r\n    const child = heap[ci];\r\n    if (cmp(child, node) > 0) return\r\n    heap[ci] = node;\r\n    heap[i] = child;\r\n    i = ci;\r\n  }\r\n}\r\n\r\nfunction cmp(a, b) {\r\n  return a.dueTime - b.dueTime\r\n}\r\n\r\nfunction peek(heap) {\r\n  return heap[0] || null\r\n}\r\n\r\nlet taskQueue = [];\r\nlet currentCallback = null;\r\nlet frameDeadline = 0;\r\nconst frameLength = 1000 / 60;\r\n\r\nfunction scheduleCallback(callback) {\r\n  const currentTime = getTime();\r\n  const startTime = currentTime;\r\n  const timeout = 3000;\r\n  const dueTime = startTime + timeout;\r\n\r\n  let newTask = {\r\n    callback,\r\n    startTime,\r\n    dueTime\r\n  };\r\n\r\n  push(taskQueue, newTask);\r\n  currentCallback = flush;\r\n  planWork();\r\n}\r\n\r\nfunction flush(iniTime) {\r\n  let currentTime = iniTime;\r\n  let currentTask = peek(taskQueue);\r\n\r\n  while (currentTask) {\r\n    const didout = currentTask.dueTime <= currentTime;\r\n    if (!didout && shouldYeild()) break\r\n\r\n    let callback = currentTask.callback;\r\n    currentTask.callback = null;\r\n\r\n    let next = callback(didout);\r\n    next ? (currentTask.callback = next) : pop(taskQueue);\r\n\r\n    currentTask = peek(taskQueue);\r\n    currentTime = getTime();\r\n  }\r\n\r\n  return !!currentTask\r\n}\r\n\r\nfunction flushWork() {\r\n  if (currentCallback) {\r\n    let currentTime = getTime();\r\n    frameDeadline = currentTime + frameLength;\r\n    let more = currentCallback(currentTime);\r\n    more ? planWork() : (currentCallback = null);\r\n  }\r\n}\r\n\r\nconst planWork = (() => {\r\n  if (typeof MessageChannel !== 'undefined') {\r\n    const { port1, port2 } = new MessageChannel();\r\n    port1.onmessage = flushWork;\r\n    return cb => (cb ? requestAnimationFrame(cb) : port2.postMessage(null))\r\n  }\r\n  return cb => setTimeout(cb || flushWork)\r\n})();\r\n\r\nfunction shouldYeild() {\r\n  return getTime() >= frameDeadline\r\n}\r\n\r\nconst getTime = () => performance.now();\r\n\r\nconst NOWORK = 0;\r\nconst PLACE = 1;\r\nconst UPDATE = 2;\r\nconst DELETE = 3;\r\n\r\nconst SVG = 4;\r\n\r\nlet preCommit = null;\r\nlet currentFiber = null;\r\nlet WIP = null;\r\nlet updateQueue = [];\r\nlet commitQueue = [];\r\n\r\nfunction render(vnode, node, done) {\r\n  let rootFiber = {\r\n    node,\r\n    props: { children: vnode },\r\n    done\r\n  };\r\n  scheduleWork(rootFiber);\r\n}\r\n\r\nfunction scheduleWork(fiber) {\r\n  if (!fiber.dirty && (fiber.dirty = true)) {\r\n    updateQueue.push(fiber);\r\n  }\r\n  scheduleCallback(reconcileWork);\r\n}\r\n\r\nfunction reconcileWork(didout) {\r\n  if (!WIP) WIP = updateQueue.shift();\r\n  while (WIP && (!shouldYeild() || didout)) {\r\n    WIP = reconcile(WIP);\r\n  }\r\n  if (!didout && WIP) {\r\n    return reconcileWork.bind(null)\r\n  }\r\n  if (preCommit) commitWork(preCommit);\r\n  return null\r\n}\r\n\r\nfunction reconcile(WIP) {\r\n  WIP.parentNode = getParentNode(WIP);\r\n  isFn(WIP.type) ? updateHOOK(WIP) : updateHost(WIP);\r\n  WIP.dirty = WIP.dirty ? false : 0;\r\n  WIP.oldProps = WIP.props;\r\n  commitQueue.push(WIP);\r\n\r\n  if (WIP.child) return WIP.child\r\n  while (WIP) {\r\n    if (!preCommit && WIP.dirty === false) {\r\n      preCommit = WIP;\r\n      return null\r\n    }\r\n    if (WIP.sibling) {\r\n      return WIP.sibling\r\n    }\r\n    WIP = WIP.parent;\r\n  }\r\n}\r\n\r\nfunction updateHOOK(WIP) {\r\n  if (\r\n    WIP.type.tag === MEMO &&\r\n    WIP.dirty == 0 &&\r\n    !shouldUpdate(WIP.oldProps, WIP.props)\r\n  ) {\r\n    cloneChildren(WIP);\r\n    return\r\n  }\r\n  currentFiber = WIP;\r\n  WIP.type.fiber = WIP;\r\n  resetCursor();\r\n  let children = WIP.type(WIP.props);\r\n  if (isStr(children)) {\r\n    children = createText(children);\r\n  }\r\n  reconcileChildren(WIP, children);\r\n}\r\n\r\nfunction updateHost(WIP) {\r\n  if (!WIP.node) {\r\n    if (WIP.type === 'svg') WIP.tag = SVG;\r\n    WIP.node = createElement(WIP);\r\n  }\r\n  let p = WIP.parentNode || {};\r\n  WIP.insertPoint = p.last || null;\r\n  p.last = WIP;\r\n  WIP.node.last = null;\r\n  reconcileChildren(WIP, WIP.props.children);\r\n}\r\n\r\nfunction getParentNode(fiber) {\r\n  while ((fiber = fiber.parent)) {\r\n    if (!isFn(fiber.type)) return fiber.node\r\n  }\r\n}\r\n\r\nfunction reconcileChildren(WIP, children) {\r\n  if (!children) return\r\n  delete WIP.child;\r\n  const oldFibers = WIP.kids;\r\n  const newFibers = (WIP.kids = hashfy(children));\r\n\r\n  let reused = {};\r\n\r\n  for (const k in oldFibers) {\r\n    let newFiber = newFibers[k];\r\n    let oldFiber = oldFibers[k];\r\n\r\n    if (newFiber && newFiber.type === oldFiber.type) {\r\n      reused[k] = oldFiber;\r\n    } else {\r\n      oldFiber.op = DELETE;\r\n      commitQueue.push(oldFiber);\r\n    }\r\n  }\r\n\r\n  let prevFiber = null;\r\n  let alternate = null;\r\n\r\n  for (const k in newFibers) {\r\n    let newFiber = newFibers[k];\r\n    let oldFiber = reused[k];\r\n\r\n    if (oldFiber) {\r\n      alternate = createFiber(oldFiber, UPDATE);\r\n      newFiber.op = UPDATE;\r\n      newFiber = { ...alternate, ...newFiber };\r\n      newFiber.lastProps = alternate.props;\r\n      if (shouldPlace(newFiber)) {\r\n        newFiber.op = PLACE;\r\n      }\r\n    } else {\r\n      newFiber = createFiber(newFiber, PLACE);\r\n    }\r\n\r\n    newFibers[k] = newFiber;\r\n    newFiber.parent = WIP;\r\n\r\n    if (prevFiber) {\r\n      prevFiber.sibling = newFiber;\r\n    } else {\r\n      if (WIP.tag === SVG) newFiber.tag = SVG;\r\n      WIP.child = newFiber;\r\n    }\r\n    prevFiber = newFiber;\r\n  }\r\n\r\n  if (prevFiber) prevFiber.sibling = null;\r\n}\r\n\r\nfunction cloneChildren(fiber) {\r\n  if (!fiber.child) return\r\n  let child = fiber.child;\r\n  let newChild = child;\r\n  newChild.op = NOWORK;\r\n  fiber.child = newChild;\r\n  newChild.parent = fiber;\r\n  newChild.sibling = null;\r\n}\r\n\r\nfunction shouldUpdate(a, b) {\r\n  for (let i in a) if (!(i in b)) return true\r\n  for (let i in b) if (a[i] !== b[i]) return true\r\n  return false\r\n}\r\n\r\nfunction shouldPlace(fiber) {\r\n  let p = fiber.parent;\r\n  if (isFn(p.type)) return p.key && !p.dirty\r\n  return fiber.key\r\n}\r\n\r\nfunction commitWork(fiber) {\r\n  commitQueue.forEach(c => c.parent && commit(c));\r\n  fiber.done && fiber.done();\r\n  commitQueue = [];\r\n  preCommit = null;\r\n  WIP = null;\r\n}\r\n\r\nfunction commit(fiber) {\r\n  const { op, parentNode, node, ref, hooks } = fiber;\r\n  if (op === NOWORK) ; else if (op === DELETE) {\r\n    hooks && hooks.list.forEach(cleanup);\r\n    cleanupRef(fiber.kids);\r\n    while (isFn(fiber.type)) fiber = fiber.child;\r\n    parentNode.removeChild(fiber.node);\r\n  } else if (isFn(fiber.type)) {\r\n    if (hooks) {\r\n      hooks.layout.forEach(cleanup);\r\n      hooks.layout.forEach(effect);\r\n      hooks.layout = [];\r\n      planWork(() => {\r\n        hooks.effect.forEach(cleanup);\r\n        hooks.effect.forEach(effect);\r\n        hooks.effect = [];\r\n      });\r\n    }\r\n  } else if (op === UPDATE) {\r\n    updateElement(node, fiber.lastProps, fiber.props);\r\n  } else {\r\n    let point = fiber.insertPoint ? fiber.insertPoint.node : null;\r\n    let after = point ? point.nextSibling : parentNode.firstChild;\r\n    if (after === node) return\r\n    if (after === null && node === parentNode.lastChild) return\r\n    parentNode.insertBefore(node, after);\r\n  }\r\n  refer(ref, node);\r\n}\r\n\r\nfunction createFiber(vnode, op) {\r\n  return { ...vnode, op }\r\n}\r\n\r\nconst hashfy = c => {\r\n  const out = {};\r\n  isArr(c)\r\n    ? c.forEach((v, i) =>\r\n        isArr(v)\r\n          ? v.forEach((vi, j) => (out[hs(i, j, vi.key)] = vi))\r\n          : (out[hs(i, null, v.key)] = v)\r\n      )\r\n    : (out[hs(0, null, c.key)] = c);\r\n  return out\r\n};\r\n\r\nfunction refer(ref, dom) {\r\n  if (ref) isFn(ref) ? ref(dom) : (ref.current = dom);\r\n}\r\n\r\nfunction cleanupRef(kids) {\r\n  for (const k in kids) {\r\n    const kid = kids[k];\r\n    refer(kid.ref, null);\r\n    if (kid.kids) cleanupRef(kid.kids);\r\n  }\r\n}\r\n\r\nconst cleanup = e => e[2] && e[2]();\r\n\r\nconst effect = e => {\r\n  const res = e[0]();\r\n  if (isFn(res)) e[2] = res;\r\n};\r\n\r\nconst getCurrentFiber = () => currentFiber || null;\r\n\r\nconst isFn = fn => typeof fn === 'function';\r\n\r\nconst hs = (i, j, k) =>\r\n  k != null && j != null\r\n    ? '.' + i + '.' + k\r\n    : j != null\r\n    ? '.' + i + '.' + j\r\n    : k != null\r\n    ? '.' + k\r\n    : '.' + i;\r\n\r\nconst Fre = {\r\n  h,\r\n  Fragment,\r\n  render,\r\n  scheduleWork,\r\n  useState,\r\n  useReducer,\r\n  useEffect,\r\n  useMemo,\r\n  useCallback,\r\n  useRef,\r\n  memo\r\n};\r\n\r\nexport default Fre;\r\nexport { Fragment, h as createElement, h, memo, render, scheduleWork, useCallback, useEffect, useLayout, useLayout as useLayoutEffect, useMemo, useReducer, useRef, useState };\r\n//# sourceMappingURL=fre.esm.js.map\r\n","import '../polyfil'\n\nimport { h, render, useState } from 'fre'\n\nfunction App(props) {\n  const [count, setCount] = useState(0)\n  return (\n    <div>\n      {count} - {props.foo}\n      <button onClick={() => setCount(count + 1)}>+</button>\n    </div>\n  )\n}\n\nfunction begin(target) {\n  render(<App foo='bar' />, document.getElementById(target))\n}\n\nexport { begin }\n"],"names":["window","addEventListener","WindowPrototype","DocumentPrototype","ElementPrototype","removeEventListener","dispatchEvent","registry","type","listener","target","unshift","event","currentTarget","preventDefault","returnValue","stopPropagation","cancelBubble","srcElement","call","attachEvent","index","register","detachEvent","splice","eventObject","fireEvent","Window","prototype","HTMLDocument","Element","document","createTextNode","data","text","createElement","innerText","performance","perf","now","mozNow","msNow","oNow","webkitNow","Date","getTime","Array","isArray","toString","$","object","forEach","fn","scope","i","len","length","Function","bind","args","arguments","apply","isArr","isStr","s","MEMO","h","attrs","props","key","ref","children","vnode","push","createText","some","v","concat","nodeValue","updateElement","dom","oldProps","newProps","name","oldValue","newValue","k","slice","toLowerCase","SVGElement","removeAttribute","setAttribute","fiber","tag","SVG","createElementNS","cursor","resetCursor","useState","initState","useReducer","reducer","getHook","hook","current","setter","value","isFn","scheduleWork","getCurrentFiber","hooks","list","effect","layout","heap","node","siftUp","pop","first","last","siftDown","pi","parent","cmp","li","left","ri","right","ci","child","a","b","dueTime","peek","taskQueue","currentCallback","frameDeadline","frameLength","scheduleCallback","callback","currentTime","startTime","timeout","newTask","flush","planWork","iniTime","currentTask","didout","shouldYeild","next","flushWork","more","MessageChannel","port1","port2","onmessage","cb","requestAnimationFrame","postMessage","setTimeout","NOWORK","PLACE","UPDATE","DELETE","preCommit","currentFiber","WIP","updateQueue","commitQueue","render","done","rootFiber","dirty","reconcileWork","shift","reconcile","commitWork","parentNode","getParentNode","updateHOOK","updateHost","sibling","shouldUpdate","cloneChildren","reconcileChildren","p","insertPoint","oldFibers","kids","newFibers","hashfy","reused","newFiber","oldFiber","op","prevFiber","alternate","createFiber","lastProps","shouldPlace","newChild","c","commit","cleanup","cleanupRef","removeChild","point","after","nextSibling","firstChild","lastChild","insertBefore","refer","out","vi","j","hs","kid","e","res","App","count","setCount","foo","begin","getElementById"],"mappings":"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"}